<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">

    <select id="checkEmail" parameterType="String" resultType="int">
        SELECT COUNT(*) 
        FROM MEMBER 
        WHERE EMAIL = #{email}
    </select>

    <select id="checkNickname" parameterType="String" resultType="int">
        SELECT COUNT(*) 
        FROM MEMBER 
        WHERE NICKNAME = #{nickname}
    </select>

    <select id="checkPhone" parameterType="String" resultType="int">
        SELECT COUNT(*) 
        FROM MEMBER 
        WHERE PHONE = #{phone}
    </select>

    <insert id="insertMember" parameterType="com.spring.app.security.domain.MemberDTO">
	    INSERT INTO MEMBER (
	        EMAIL, USER_NO, PASSWORD, USER_NAME, NICKNAME, 
	        PHONE, GENDER, BIRTH_DATE, 
	        POSTCODE, ADDRESS, DETAILADDRESS, EXTRAADDRESS,
	        REG_DATE, STATUS, IDLE, SUSPENDED, 
	        CASH_BALANCE, MANNER_TEMP, PROFILE_IMG
	    ) VALUES (
	        #{email}, 
	        SEQ_MEMBER_NO.NEXTVAL, 
	        #{password}, 
	        #{userName}, 
	        #{nickname}, 
	        #{phone, jdbcType=VARCHAR}, 
	        #{gender, jdbcType=VARCHAR}, 
	        #{birthDate, jdbcType=VARCHAR}, 
	        #{postcode},           #{address},            #{detailaddress},      #{extraaddress, jdbcType=VARCHAR},
	        SYSDATE,               0,                     0,                     0,                     0,                     36.5,                  #{profileImg, jdbcType=VARCHAR}
	    )
	</insert>

	<select id="findByEmail" parameterType="String" resultType="com.spring.app.security.domain.MemberDTO">
        SELECT 
            EMAIL AS email, 
            USER_NO AS userNo, 
            PASSWORD AS password, 
            USER_NAME AS userName, 
            PHONE AS phone, 
            GENDER AS gender, 
            BIRTH_DATE AS birthDate, 
            NICKNAME AS nickname, 
            ADDRESS AS address, 
            PROFILE_IMG AS profileImg
        FROM MEMBER
        WHERE EMAIL = #{email} AND IS_WITHDRAWN = 'N'
    </select>
</mapper>
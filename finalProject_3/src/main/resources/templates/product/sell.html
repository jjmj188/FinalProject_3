<!DOCTYPE html>
<html
	th:replace="~{layout/layout_main :: layout(~{::head}, ~{::main}, ~{::script})}"
	xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<link rel="stylesheet" th:href="@{/css/product_form.css}">
<script defer th:src="@{/js/product_form.js}"></script>
<!-- <script defer th:src="@{/js/product_form_address.js}"></script> -->

<style>
  /* ì˜¤íƒ€ ìˆ˜ì •: select-box -> .select-box */
  .select-box{
    display:flex;
    align-items:center;
    gap:6px;
    padding:0 14px 0 10px;
    border-right:1px solid #e5e7eb;
    height:100%;
    flex:0 0 auto;
  }

  /* =========================
     ì§€ì—­ ë³€ê²½ ëª¨ë‹¬
  ========================= */

  .area-modal{
    position: fixed;
    inset: 0;
    display: none;
    z-index: 9999;
  }
  .area-modal.is-open{ display:block; }

  /* ë°˜íˆ¬ëª… ë°°ê²½ */
  .area-modal__backdrop{
    position:absolute;
    inset:0;
    background: rgba(0,0,0,.35);
  }

  /* ëª¨ë‹¬ íŒ¨ë„ */
  .area-modal__panel{
    position: relative;
    width: min(720px, calc(100% - 48px));
    max-height: min(720px, calc(100vh - 80px));
    margin: 40px auto;
    border-radius: 18px;
    background: #ffffff;
    color: #111;
    box-shadow: 0 20px 60px rgba(0,0,0,.18);
    border: 1px solid rgba(0,0,0,.08);
    overflow: hidden;
  }

  /* í—¤ë” */
  .area-modal__header{
    display:flex;
    align-items:center;
    justify-content: space-between;
    padding: 18px 18px 12px;
    border-bottom: 1px solid rgba(0,0,0,.08);
  }
  .area-modal__title{
    font-size: 18px;
    font-weight: 700;
    margin: 0;
  }
  .area-modal__close{
    width: 40px;
    height: 40px;
    border: 0;
    border-radius: 10px;
    background: transparent;
    color: #444;
    cursor: pointer;
    font-size: 26px;
    line-height: 1;
  }
  .area-modal__close:hover{
    background: rgba(0,0,0,.05);
  }

  .area-modal__body{
    padding: 14px 18px 18px;
  }

/* ì§€ì—­, ë™ë„¤ ê²€ìƒ‰ ë²„íŠ¼ */
  .area-search{
    width: 100%;
    margin-top: 12px;
    border-radius: 12px;
    padding: 12px 14px;
     background: #f6f7f9;
    border: 1px solid rgba(0,0,0,.10);
     color: rgba(0,0,0,.45);
    font-weight: 700;
    cursor: pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap: 10px;
    
  }
  .area-search:hover{
    filter: brightness(1.02);
  }

  /* í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ */
  .area-geo{
    width: 100%;
    margin-top: 12px;
    border-radius: 12px;
    padding: 12px 14px;
    background: #fff3ea;
    color: #ff6a00;
    font-weight: 700;
    cursor: pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap: 10px;
    border: 1px solid rgba(255,106,0,.25);
  }
  .area-geo:hover{
    filter: brightness(1.02);
  }

  /* ë¦¬ìŠ¤íŠ¸ */
  .area-list{
    margin-top: 16px;
  }
  .area-list__title{
    font-size: 14px;
    color: rgba(0,0,0,.55);
    margin-bottom: 10px;
  }
  .area-list__items{
    list-style:none;
    padding:0;
    margin:0;
    max-height: 360px;
    overflow:auto;
    border-radius: 12px;
    background: #fff;
  }

  /* ìŠ¤í¬ë¡¤ë°” */
  .area-list__items::-webkit-scrollbar{ width: 10px; }
  .area-list__items::-webkit-scrollbar-thumb{
    background: rgba(0,0,0,.18);
    border-radius: 999px;
  }
  .area-list__items::-webkit-scrollbar-track{
    background: rgba(0,0,0,.06);
    border-radius: 999px;
  }

  .area-item{
    width: 100%;
    text-align: left;
    border: 0;
    background: transparent;
    color: #111;
    padding: 14px 10px;
    cursor:pointer;
    border-bottom: 1px solid rgba(0,0,0,.08);
  }
  .area-item:hover{
    background: rgba(0,0,0,.04);
  }
</style>

</head>

<body>
	<main class="pf-wrap" data-active="sell">
		<!-- ìƒë‹¨ íƒ­ -->
		<nav class="pf-tabs" aria-label="ë“±ë¡ ìœ í˜•">
			<a class="pf-tab" th:href="@{/product/sell}" data-tab="sell">íŒë§¤í•˜ê¸°</a>
			<a class="pf-tab" th:href="@{/product/share}" data-tab="share">ë‚˜ëˆ”í•˜ê¸°</a>
			<a class="pf-tab" th:href="@{/product/auction}" data-tab="auction">ê²½ë§¤í•˜ê¸°</a>
			<span class="pf-tab-underline" aria-hidden="true"></span>
		</nav>

		<!-- ì„¹ì…˜ íƒ€ì´í‹€ -->
		<section class="pf-section">
			<h2 class="pf-title">ìƒí’ˆ ì •ë³´</h2>
			<div class="pf-title-line" aria-hidden="true"></div>

			<div class="pf-form">

				<!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
				<div class="pf-row">
					<div class="pf-label">ìƒí’ˆ ì´ë¯¸ì§€</div>

					<div class="pf-field pf-field-upload">
						<label class="pf-upload" for="pfImageInput"> <span
							class="pf-upload-icon" aria-hidden="true">ğŸ“·</span> <span
							class="pf-upload-text">ì´ë¯¸ì§€ ë“±ë¡</span> <input id="pfImageInput"
							class="pf-upload-input" type="file" accept="image/*" multiple />
						</label>

						<div class="pf-preview" id="pfPreviewWrap" aria-label="ë¯¸ë¦¬ë³´ê¸°"></div>
						<!-- ëŒ€í‘œ ì´ë¯¸ì§€ ì¸ë±ìŠ¤(0,1,2) -->
						<input type="hidden" id="pfMainIndex" name="mainIndex" value="0">
					</div>
				</div>

				<!-- ìƒí’ˆëª… -->
				<div class="pf-row">
					<div class="pf-label">
						ìƒí’ˆëª…
						<div class="pf-help">
							<a class="pf-ship-setting" id="pfShipSettingLink" href="#">ê±°ë˜
								ì œí•œ í’ˆëª© ì•ˆë‚´ &gt;</a>
						</div>

						<!-- íŒì—… ëª¨ë‹¬ -->
						<div id="pfShipModal" class="pf-modal">
							<div class="pf-modal-content">
								<button type="button" class="pf-modal-close"
									id="pfShipModalClose">Ã—</button>

								<img th:src="@{/images/transactionRestrictions.png}"
									alt="ê±°ë˜ì œí•œí’ˆëª©">
							</div>
						</div>

					</div>
					<div class="pf-field">
						<input class="pf-input" type="text" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." />
					</div>
				</div>

				<!-- ì¹´í…Œê³ ë¦¬ -->
				<div class="pf-row">
					<div class="pf-label">ì¹´í…Œê³ ë¦¬</div>
					<div class="pf-field pf-field-narrow">
						<select class="pf-select" aria-label="ì¹´í…Œê³ ë¦¬">
							<option>íŒ¨ì…˜(ìˆ˜ì…ëª…í’ˆ / íŒ¨ì…˜ì˜ë¥˜ / íŒ¨ì…˜ì¡í™” / ë·°í‹°)</option>
							<option>ìœ¡ì•„(ì¶œì‚° / ìœ ì•„ë™)</option>
							<option>ê°€ì „(ê°€ì „ì œí’ˆ)</option>
							<option>í™ˆÂ·ì¸í…Œë¦¬ì–´(ê°€êµ¬ / ì¸í…Œë¦¬ì–´ / ë¦¬ë¹™ / ìƒí™œ)</option>
							<option>ì·¨ë¯¸(ê²Œì„, ë°˜ë ¤ë™ë¬¼, ë…ì„œ)</option>
							<option>ì—¬í–‰(ë“±ì‚°, ìº í•‘ ë“±ë“±)</option>
							<option>ê³µêµ¬/ì‚°ì—…ìš©í’ˆ</option>
						</select>
					</div>
				</div>



				<!-- íŒë§¤ ê°€ê²© + ì‹œì„¸ ì¡°íšŒ -->
				<div class="pf-row pf-row-split">
					<div class="pf-label">íŒë§¤ ê°€ê²©</div>
					<div class="pf-field pf-field-split">
						<input class="pf-input" type="text" inputmode="numeric"
							placeholder="â‚© íŒë§¤ê°€ê²©" />

					</div>
				</div>

				<!-- ìƒí’ˆ ì„¤ëª… -->
				<div class="pf-row">
					<div class="pf-label">ìƒí’ˆ ì„¤ëª…</div>
					<div class="pf-field">
						<div class="pf-textarea-wrap">
							<textarea class="pf-textarea" maxlength="5000"
								placeholder="- ìƒí’ˆëª…(ë¸Œëœë“œ)
- êµ¬ë§¤ ì‹œê¸° (ë…„, ì›”, ì¼)
- ì‚¬ìš© ê¸°ê°„
- í•˜ì ì—¬ë¶€
* ì‹¤ì œ ì´¬ì˜í•œ ì‚¬ì§„ê³¼ í•¨ê»˜ ìƒì„¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
* ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë”” ì²¨ë¶€ ì‹œ ê²Œì‹œê¸€ ì‚­ì œ ë° ì´ìš©ì œì¬ ì²˜ë¦¬ ë  ìˆ˜ ìˆì–´ìš”.

ì•ˆì „í•˜ê³  ê±´ì „í•œ ê±°ë˜í™˜ê²½ì„ ìœ„í•´ ê³¼í•™ê¸°ìˆ ì •ë³´í†µì‹ ë¶€, í•œêµ­ì¸í„°ë„·ì§„í¥ì›, ì¤‘ê³ ë‚˜ë¼ê°€ í•¨ê»˜í•©ë‹ˆë‹¤."></textarea>
							<div class="pf-count">
								<span class="pf-count-now">0</span> / 5000
							</div>
						</div>
					</div>
				</div>

				<!-- ìƒí’ˆ ìƒíƒœ -->
				<div class="pf-row">
					<div class="pf-label">ìƒí’ˆ ìƒíƒœ</div>
					<div class="pf-field">
						<div class="pf-radio-row" role="radiogroup" aria-label="ìƒí’ˆ ìƒíƒœ">
							<label class="pf-radio"> <input type="radio"
								name="pfCond" checked /> <span class="pf-dot"
								aria-hidden="true"></span> <span>ìƒ</span>
							</label> <label class="pf-radio"> <input type="radio"
								name="pfCond" /> <span class="pf-dot" aria-hidden="true"></span>
								<span>ì¤‘</span>
							</label> <label class="pf-radio"> <input type="radio"
								name="pfCond" /> <span class="pf-dot" aria-hidden="true"></span>
								<span>í•˜</span>
							</label>
						</div>
					</div>
				</div>

				<!-- ê±°ë˜ ë°©ë²• -->
				<div class="pf-trade">
					<div class="pf-trade-head">
						<div class="pf-trade-title">ê±°ë˜ ë°©ë²•</div>
						<div class="pf-trade-sub">êµ¬ë§¤ìê°€ ê²°ì œí•œ ì´í›„ì—ëŠ” ê±°ë˜ ë°©ë²•ì„ ë³€ê²½í•  ìˆ˜ ì—†ì–´ìš”</div>
					</div>
					<div class="pf-trade-wrap">

						<!-- ===== íƒë°°ê±°ë˜ ===== -->
						<section class="pf-section">
							<div class="pf-section-title">íƒë°°ê±°ë˜</div>

							<div class="pf-trade-row">
								<div class="pf-trade-left">
									<label class="pf-check"> <input type="radio"
										name="pfTradeMethod" id="pfShipToggle" checked /> <span
										class="pf-check-ui" aria-hidden="true"></span> <span
										class="pf-check-text">íƒë°°ê±°ë˜</span>
									</label>
								</div>


							</div>

							<!-- ë°°ì†¡ë¹„ í¬í•¨ ì—¬ë¶€ ì¹´ë“œ -->
							<div class="pf-ship-card" id="pfShipCard">
								<div class="pf-ship-card-head">
									<p class="pf-ship-card-title">ë°°ì†¡ë¹„ í¬í•¨ ì—¬ë¶€ ì„ íƒ</p>
									<p class="pf-ship-card-desc">ìƒí’ˆì— í‘œì‹œë  ë°°ì†¡ë¹„ ì •ë³´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
								</div>

								<div class="pf-ship-divider"></div>

								<div class="pf-ship-pill">
									<span class="pf-ship-pill-dot" aria-hidden="true"></span> ê±°ë˜ ì„±ì‚¬
									í™•ë¥ ì´ ë†’ì•„ìš”
								</div>

								<div class="pf-ship-option">
									<label class="pf-radio"> <input type="radio"
										name="pfShipFeeType" value="included" id="pfFeeIncluded" /> <span
										class="pf-radio-ui" aria-hidden="true"></span> <span
										class="pf-radio-body"> <span class="pf-radio-title">ë°°ì†¡ë¹„
												í¬í•¨</span> <span class="pf-radio-desc">ì„ íƒ ì‹œ ìƒí’ˆì— â€˜ë¬´ë£Œë°°ì†¡â€™ìœ¼ë¡œ
												í‘œì‹œë©ë‹ˆë‹¤.</span>
									</span>
									</label>
								</div>

								<div class="pf-ship-option">
									<label class="pf-radio"> <input type="radio"
										name="pfShipFeeType" value="separate" id="pfFeeSeparate"
										checked /> <span class="pf-radio-ui" aria-hidden="true"></span>

										<span class="pf-radio-body"> <span
											class="pf-radio-title">ë°°ì†¡ë¹„ ë³„ë„</span> <span
											class="pf-radio-desc">ìƒí’ˆê°€ê²©ê³¼ ë³„ë„ë¡œ ë°°ì†¡ë¹„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</span>
									</span>
									</label>
								</div>
							</div>

							<!-- ë°°ì†¡ë¹„ ì…ë ¥(ë°°ì†¡ë¹„ ë³„ë„ ì„ íƒ ì‹œ ë…¸ì¶œ) -->
							<div class="pf-ship-fee-detail" id="pfShipFeeDetail"
								aria-hidden="true">
								<div class="pf-ship-fee-head">
									<h3 class="pf-ship-fee-title">ë°°ì†¡ë¹„ ì…ë ¥</h3>
								</div>

								<p class="pf-ship-fee-sub">ê°€ëŠ¥í•œ ë°°ì†¡ ë°©ë²•ë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>

								<!-- ì¼ë°˜íƒë°° -->
								<div class="pf-ship-fee-block">
									<div class="pf-ship-fee-label">ì¼ë°˜íƒë°°</div>
									<div class="pf-ship-fee-desc">íƒë°°ì‚¬ë‚˜ í¸ì˜ì ì—ì„œ ì ‘ìˆ˜í•´ ë¬¸ ì•ê¹Œì§€ ë°°ì†¡ë¼ìš”.</div>
									<input class="pf-input pf-ship-fee-input" type="text"
										inputmode="numeric" placeholder="2,700ì›~17,000ì› ì´ë‚´" />
								</div>

								<!-- CU/GS ë°˜ê°’íƒë°° -->
								<div class="pf-ship-fee-block">
									<div class="pf-ship-fee-label">CU ë°˜ê°’íƒë°° / GS ë°˜ê°’íƒë°°</div>
									<div class="pf-ship-fee-desc">í¸ì˜ì ì—ì„œ ë³´ë‚´ê³ , ì§€ì •í•œ í¸ì˜ì ì—ì„œ ì°¾ì•„ê°€ìš”.</div>

									<div class="pf-ship-fee-mini">

										<div class="pf-ship-fee-brand ">
											<img th:src="@{/images/cu.png}">
										</div>
										<input class="pf-input pf-ship-fee-input" type="text"
											inputmode="numeric" placeholder="1,800ì›~2,700ì› ì´ë‚´" />
									</div>

									<div class="pf-ship-fee-mini">
										<div class="pf-ship-fee-brand">
											<img th:src="@{/images/GS25.svg}">
										</div>
										<input class="pf-input pf-ship-fee-input" type="text"
											inputmode="numeric" placeholder="1,900ì›~4,400ì› ì´ë‚´" />
									</div>
								</div>
							</div>
						</section>

						<!-- ===== ì§ê±°ë˜ ===== -->
						<section class="pf-section">
							<div class="pf-section-title">ì§ê±°ë˜</div>

							<div class="pf-trade-row">
								<div class="pf-trade-left">
									<label class="pf-check"> <input type="radio"
										name="pfTradeMethod" id="pfMeetToggle" /> <span
										class="pf-check-ui" aria-hidden="true"></span> <span
										class="pf-check-text">ë§Œë‚˜ì„œ ì§ê±°ë˜</span>
									</label>
								</div>

								<div class="pf-trade-right">
								
								
<!-- ì§€ì—­ ì„¤ì • ë²„íŠ¼ -->
<div class="select-box">
  <button type="button" class="btn-area">
    <i class="fa-solid fa-location-dot"></i><span>ì§€ì—­ì„¤ì •</span>
  </button>
</div>


<!-- ì§€ì—­ ë³€ê²½ ëª¨ë‹¬ -->
<section class="area-modal" id="areaModal" aria-hidden="true">
  <div class="area-modal__backdrop" data-area-close="true"></div>

  <div class="area-modal__panel" role="dialog" aria-modal="true" aria-labelledby="areaModalTitle">
    <div class="area-modal__header">
      <h2 class="area-modal__title" id="areaModalTitle">ì§€ì—­ ë³€ê²½</h2>
      <button type="button" class="area-modal__close" aria-label="ë‹«ê¸°" data-area-close="true">Ã—</button>
    </div>

    <div class="area-modal__body">
      <!-- âœ… input ëŒ€ì‹  "ê²€ìƒ‰ì°½ì²˜ëŸ¼ ìƒê¸´ ë²„íŠ¼" -->
     
       
        <button type="button" class="area-search" id="areaSearchBtn">
        <i class="fa-solid fa-location-dot"></i>
          ì§€ì—­ì´ë‚˜ ë™ë„¤ë¡œ ê²€ìƒ‰í•˜ê¸°
        </button>
    

      <button type="button" class="area-geo" id="areaUseGeoBtn">
        <i class="fa-solid fa-location-crosshairs" aria-hidden="true"></i>
        í˜„ì¬ ë‚´ ìœ„ì¹˜ ì‚¬ìš©í•˜ê¸°
      </button>

      <div class="area-list">
        <div class="area-list__title">ìµœê·¼ ê²€ìƒ‰í•œ ë™ë„¤</div>
        <ul class="area-list__items" id="areaList">
          <li><button type="button" class="area-item" data-area-value="ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜1ë™">ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜1ë™</button></li>
          <li><button type="button" class="area-item" data-area-value="ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜ë™">ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜ë™</button></li>
          <li><button type="button" class="area-item" data-area-value="ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜2ë™">ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜2ë™</button></li>
          <li><button type="button" class="area-item" data-area-value="ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜4ë™">ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ëŒ€ì¹˜4ë™</button></li>
          <li><button type="button" class="area-item" data-area-value="ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ê°œí¬3ë™">ì„œìš¸íŠ¹ë³„ì‹œ, ê°•ë‚¨êµ¬, ê°œí¬3ë™</button></li>
        </ul>
      </div>
    </div>
  </div>
</section>
									<!-- <button type="button" class="pf-loc-btn" id="pfLocationBtn">+
										ìœ„ì¹˜ ì„¤ì •</button> -->
									<!-- <button type="button" class="pf-loc-btn" id="pfMyLocationBtn">ë‚´
										ìœ„ì¹˜</button>
									<span class="pf-loc-text" id="pfLocationText">ìœ„ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”</span> -->
								</div>

								<!-- ì„œë²„ë¡œ ë³´ë‚¼ ê°’(ìˆ¨ê¹€) -->
								<input type="hidden" id="pfAddress" name="address" /> <input
									type="hidden" id="pfExtraAddress" name="extraAddress" /> <input
									type="hidden" id="pfLat" name="lat" /> <input type="hidden"
									id="pfLng" name="lng" />

								<!-- í‘œì‹œìš©ì£¼ì†Œ -->
								<input type="hidden" id="pfShortAddress" name="shortAddress" />
						</section>

					</div>
				</div>

				<!-- í•˜ë‹¨ ì•ˆë‚´ + ë²„íŠ¼ -->
				<div class="pf-footnote">íŒë§¤ ì •ë³´ê°€ ì‹¤ì œ ìƒí’ˆê³¼ ë‹¤ë¥¸ ê²½ìš°, ì±…ì„ì€ íŒë§¤ìì—ê²Œ ìˆìŒì„
					ë™ì˜í•©ë‹ˆë‹¤.</div>
				<button class="pf-submit" type="button">íŒë§¤í•˜ê¸°</button>

			</div>
		</section>

	</main>

	<script>
(function(){
  // =========================
  // DOM
  // =========================
  const openBtn   = document.querySelector(".btn-area");      // ìƒë‹¨ "ì§€ì—­ì„¤ì •" ë²„íŠ¼
  const modal     = document.getElementById("areaModal");
  const list      = document.getElementById("areaList");
  const useGeoBtn = document.getElementById("areaUseGeoBtn");
  const searchBtn = document.getElementById("areaSearchBtn"); // "ì§€ì—­ì´ë‚˜ ë™ë„¤ë¡œ ê²€ìƒ‰í•˜ê¸°" ë²„íŠ¼

  if(!openBtn || !modal || !list) return;

  let lastFocusedEl = null;

  // =========================
  // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
  // =========================
  function openModal(){
    lastFocusedEl = document.activeElement;
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function closeModal(){
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
    if(lastFocusedEl) lastFocusedEl.focus();
  }

  openBtn.addEventListener("click", openModal);

  modal.addEventListener("click", (e) => {
    if(e.target.closest("[data-area-close='true']")) closeModal();
  });

  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape" && modal.classList.contains("is-open")) closeModal();
  });

  // =========================
  // ê³µí†µ: ì„¤ì • ì™„ë£Œ ì²˜ë¦¬ (âœ… ì „ì²´ ì£¼ì†Œë§Œ í‘œì‹œ)
  // =========================
  function applyLocationResult(opts){
    // opts: { fullAddress, extraAddress, lat, lng }
    const labelSpan = openBtn.querySelector("span");
    if(labelSpan){
      labelSpan.textContent = opts.fullAddress || "ì§€ì—­ì„¤ì •";
    }
  }

  // =========================
  // ì¹´ì¹´ì˜¤ SDK ë¡œë“œ ëŒ€ê¸°
  // =========================
  function waitForKakaoServices(cb, tries = 40) {
    const ok = window.kakao && kakao.maps && kakao.maps.services;
    if (ok) return cb();

    if (tries <= 0) {
      console.error("ì¹´ì¹´ì˜¤ SDK ë¡œë“œ ì‹¤íŒ¨: Networkì—ì„œ sdk.js 200 í™•ì¸ + ì¤‘ë³µ ë¡œë“œ ì œê±°");
      return;
    }
    setTimeout(() => waitForKakaoServices(cb, tries - 1), 100);
  }

  function ensureKakaoServices(){
    if (!window.kakao || !kakao.maps || !kakao.maps.services) {
      console.error("kakao.maps.services ë¡œë“œ ì•ˆë¨ (&libraries=services í™•ì¸)");
      return false;
    }
    return true;
  }

  // =========================
  // ì£¼ì†Œ <-> ì¢Œí‘œ ë³€í™˜
  // =========================
  function addressToLatLng(address, cb){
    if (!ensureKakaoServices()) return;

    const geocoder = new kakao.maps.services.Geocoder();
    geocoder.addressSearch(address, function(result, status){
      if (status === kakao.maps.services.Status.OK) {
        cb(result[0].y, result[0].x);
      } else {
        cb("", "");
      }
    });
  }

  function latLngToFullAddress(lat, lng, cb){
    if (!ensureKakaoServices()) return;

    const geocoder = new kakao.maps.services.Geocoder();
    geocoder.coord2Address(lng, lat, function(result, status){
      if (status === kakao.maps.services.Status.OK) {
        const jibun = result[0].address ? result[0].address.address_name : "";
        const road  = result[0].road_address ? result[0].road_address.address_name : "";
        cb(road || jibun);
      } else {
        cb("");
      }
    });
  }

  // =========================
  // 1) ì£¼ì†Œ ê²€ìƒ‰ íŒì—…(daum Postcode)
  // =========================
  function openPostcodeForLocation(){
    new daum.Postcode({
      oncomplete: function(data) {
        let addr = '';
        let extraAddr = '';

        if (data.userSelectedType === 'R') addr = data.roadAddress;
        else addr = data.jibunAddress;

        if (data.userSelectedType === 'R') {
          if (data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)) {
            extraAddr += data.bname;
          }
          if (data.buildingName !== '' && data.apartment === 'Y') {
            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
          }
          if (extraAddr !== '') extraAddr = ' (' + extraAddr + ')';
        } else {
          extraAddr = '';
        }

        const full = addr + extraAddr;

        // âœ… ì „ì²´ ì£¼ì†Œë§Œ í™”ë©´ì— í‘œì‹œ
        applyLocationResult({ fullAddress: full });

        // (ì„ íƒ) ì£¼ì†Œ -> ì¢Œí‘œ ë³€í™˜ê¹Œì§€ í•´ë‘ê¸° (í•„ìš”í•˜ë©´ ì €ì¥/ë§ˆì»¤)
        addressToLatLng(addr, function(lat, lng){
          // ì˜ˆ: hidden input ì €ì¥ or ì§€ë„ ë§ˆì»¤ ì´ë™
          // console.log("lat/lng:", lat, lng);
        });

        // ëª¨ë‹¬ ë‹«ê¸°
        closeModal();
      }
    }).open();
  }

  // =========================
  // 2) ë‚´ ìœ„ì¹˜(geolocation)
  // =========================
  function setMyLocation(){
    if (!navigator.geolocation) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      function(pos){
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        // ì¢Œí‘œ -> ì „ì²´ ì£¼ì†Œë§Œ í‘œì‹œ
        latLngToFullAddress(lat, lng, function(fullAddr){
          applyLocationResult({ fullAddress: fullAddr || "ì§€ì—­ì„¤ì •" });
          closeModal();
        });
      },
      function(err){
        if (err.code === 1) alert("ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.");
        else if (err.code === 2) alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        else if (err.code === 3) alert("ìœ„ì¹˜ ì¡°íšŒ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.");
        else alert("ìœ„ì¹˜ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      },
      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
    );
  }

  // =========================
  // ë¦¬ìŠ¤íŠ¸ í´ë¦­(ìµœê·¼ ê²€ìƒ‰í•œ ë™ë„¤) -> ì „ì²´ ì£¼ì†Œë¡œ í‘œì‹œ
  // =========================
  list.addEventListener("click", (e) => {
    const btn = e.target.closest(".area-item");
    if(!btn) return;

    const val = btn.getAttribute("data-area-value") || btn.textContent.trim();
    applyLocationResult({ fullAddress: val });
    closeModal();
  });

  // =========================
  // ë²„íŠ¼ë“¤ ì—°ê²° (ì¹´ì¹´ì˜¤ ë¡œë“œ í›„)
  // =========================
  waitForKakaoServices(function(){
    if(searchBtn){
      searchBtn.addEventListener("click", openPostcodeForLocation);
    }
    if(useGeoBtn){
      useGeoBtn.addEventListener("click", setMyLocation);
    }
  });

})();
</script>
</body>
</html>